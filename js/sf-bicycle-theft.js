var VIZ=function(e){return e.sfBicycleTheft=function(){var e=d3.select("#sfBicycleTheft"),t=parseInt(e.style("width")),r=.6*t,n=function(){return e.style("height",r+"px"),new L.Map("sfBicycleTheft",{center:[37.775,-122.444],zoom:13}).addLayer(new L.TileLayer("http://{s}.tiles.mapbox.com/v3/lukewhyte.i8ahci39/{z}/{x}/{y}.png"))}(),i=d3.select(n.getPanes().overlayPane).append("svg"),o=i.append("g").attr("class","leaflet-zoom-hide");d3.json("/data/sf-bike-theft/bike-crime-geo.json",function(e,t){function r(e){for(var t=0,r=e.length,n={};r>t;t++)"800 Block of BRYANT ST"!==e[t].properties.address?(n[e[t].geometry.coordinates]?n[e[t].geometry.coordinates]+=5:n[e[t].geometry.coordinates]=5,e[t].properties.radius=n[e[t].geometry.coordinates]):e[t].properties.radius=0}function a(e,t){var r=n.latLngToLayerPoint(new L.LatLng(t,e));this.stream.point(r.x,r.y)}function s(e){var e=e.toLowerCase();return e.charAt(0).toUpperCase()+e.slice(1)}function p(e){var t=new Date(1e3*e);return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()}function c(e){var t=parseInt(e.slice(0,e.indexOf(":")));return t>12?t-12+e.slice(e.indexOf(":"))+"pm":t+e.slice(e.indexOf(":"))+"am"}function d(){var e=f.bounds(t),r=e[0],a=e[1];f.pointRadius(function(e){return n.getZoom()<16?e.properties.radius:1.5*e.properties.radius}),i.attr("width",a[0]+10-(r[0]-10)).attr("height",a[1]+10-(r[1]-10)).style("left",r[0]+"px").style("top",r[1]+"px"),o.attr("transform","translate("+-r[0]+","+-r[1]+")"),l.attr({d:function(e){return f(e)},"fill-opacity":function(e){return 5===e.properties.radius?.5:e.properties.radius<=10?.35:.25}}).append("title").text(function(e){return"Crime: "+s(e.properties.crime)+"\nDate: "+p(e.properties.date)+", "+c(e.properties.time)+"\nAddress: "+s(e.properties.address)})}if(e)return console.warn(e);r(t.features);var u=d3.geo.transform({point:a}),f=d3.geo.path().projection(u),l=o.selectAll("path").data(t.features.sort(function(e,t){return t.properties.radius-e.properties.radius})).enter().append("path");n.on("viewreset",d),d()})},e}(VIZ||{});